---
title: "04_DataChecking"
output: html_document
date: "2025-04-28"
---

Purpose: Compare the values imputed with the original observed values 

Inputs 
imputedtraitdata.csv - imputed traits 
funspacedata.csv - observed traits
Indo_Pacific_data.rds - area for the indopacific regions 


Outputs 
imputed_fecundity.csv - imputed traits and calculated fecundity levels (eggs per area - fecundity, eggs per average colony area - colony_fecundity, eggs total across the indo-pacific area - indo-pacific_fecundity)


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readxl)
library(dplyr)
library(tidyverse)
library(caret)
library(RColorBrewer)
library(ggbiplot)
library(viridis)
```

Only 3 species for colony area does not seem right, trying to upload the data directly from coral trait database, but otherwise will use the current data and the transformed data for fecundity values 

## Q-Q plot 

Q-Q Plot: Here, Imputed values are plotted as sample quantiles, and Original values are used for the reference line.
```{r}

coral_data_imputed <- read.csv(file="imputedtraitdata.csv")

coral_data <- read.csv(file = "funspacedata.csv")

ppa <- coral_data %>%
  dplyr::select(Species, Polyps_per_area)

ppa_imputed <- coral_data_imputed %>%
  dplyr::select(Species, Polyps_per_area)

ca <- coral_data %>%
  dplyr::select(Species, Colony_area)

ca_imputed <- coral_data_imputed %>%
  dplyr::select(Species, Colony_area)

# Combine measured and imputed data for Polyps.per.area
ppa_combined <- ppa %>%
  rename(Original = Polyps_per_area) %>%
  left_join(ppa_imputed %>% rename(Imputed = Polyps_per_area), by = "Species")

# Combine measured and imputed data for Colony.area
ca_combined <- ca %>%
  rename(Original = Colony_area) %>%
  left_join(ca_imputed %>% rename(Imputed = Colony_area), by = "Species")

ggplot(ppa_combined, aes(sample = Imputed)) +
  stat_qq() +
  stat_qq_line(aes(sample = Original), color = "red") +
  labs(title = "Q-Q Plot for Polyps per Area (Imputed Values with Measured Line)",
       x = "Theoretical Quantiles (Measured Values)",
       y = "Sample Quantiles (Imputed Values)") +
  theme_minimal()

# Q-Q Plot for Colony.area (Imputed values plotted, measured as reference line)
ggplot(ca_combined, aes(sample = Imputed)) +
  stat_qq() +
  stat_qq_line(aes(sample = Original), color = "red") +
  labs(title = "Q-Q Plot for Colony Area (Imputed Values with Measured Line)",
       x = "Theoretical Quantiles (Measured Values)",
       y = "Sample Quantiles (Imputed Values)") +
  theme_minimal()



# 1:1 Plot for Polyps per Area
ggplot(ppa_combined, aes(x = Original, y = Imputed)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_abline(slope = 1, intercept = 0, color = "red", linetype = "dashed") +
  labs(title = "1:1 Plot for Polyps per Area (Imputed Values)",
       x = "Measured Values",
       y = "Imputed Values") +
  theme_minimal() +
  coord_equal()

# 1:1 Plot for Colony Area
ggplot(ca_combined, aes(x = Original, y = Imputed)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_abline(slope = 1, intercept = 0, color = "red", linetype = "dashed") +
  labs(title = "1:1 Plot for Colony Area (Imputed Values)",
       x = "Measured Values",
       y = "Imputed Values") +
  theme_minimal() +
  coord_equal()
```

## Get fecundity per cm^2 multiply polyp per area and colony area (planar area) 

plot fecundity as genus or another option 
Fecundity -> per cm^2

```{r}
#fecundity 
imputed <- read.csv(file = "imputedtraitdata.csv")

imputed$fecundity <- (imputed$Polyps_per_area * imputed$Polyp_fecundity)

#colony.fecundity
imputed$Colony_fecundity <- (imputed$fecundity * imputed$Colony_area)

Indo_Pacific <- readRDS(file="data/Indo_Pacific_data.rds")
imputed$coralcover <- (imputed$MeanPCcover * (sum(Indo_Pacific$area_km2)/0.7))

imputed$IndoPacific_fecundity = (imputed$coralcover * imputed$fecundity *1e10)

imputed <- imputed %>%
  mutate(Genus = sapply(strsplit(Species, " "), `[`, 1))

imputed <- imputed%>%
  filter(!is.na(coralcover))

write.csv(imputed, file = "imputed_fecundity.csv")
```
